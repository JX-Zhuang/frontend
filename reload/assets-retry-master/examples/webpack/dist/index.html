<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script>!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).assetsRetry=t()}(this,function(){"use strict";function r(e){return e}function u(){}function o(e,t,n){e[t]=e[t]||n}function c(e,t){try{return"function"==typeof e[t]}catch(e){return!1}}function i(e){return Array.isArray(e)?e.reduce(function(e,t,n,r){return e[t]=r[(n+1)%r.length],e},{}):e}function a(t,e){return Object.keys(e).filter(function(e){return-1<t.indexOf(e)}).sort(function(e,t){return t.length-e.length})[0]}var y="retryTimes",m="succeeded",v="failed",f="maxRetryCount",h="onRetry",g="domain",E="_$assetsRetryScript",b="_$assetsRetryOnerror",s="script",O="data-assets-retry-hooked",l="data-retry-id",j=window.document,d=Object.prototype.hasOwnProperty,L=function(e,t,n){var r=e.indexOf(t);return e.substring(0,r)+n+e.substring(r+t.length)},T=function(t,e,n){if(void 0===n&&(n=u),"loading"!==document.readyState){var r=j.createElement(s);console.log("[document.createElement]",e),Object.keys(HTMLScriptElement.prototype).forEach(function(e){if("src"!==e&&t[e]&&"object"!=typeof t[e])try{r[e]=t[e]}catch(e){}}),r.src=e,r.onload=t.onload,r.onerror=t.onerror;var o=t.getAttribute("nonce");o&&r.setAttribute("nonce",o),j.getElementsByTagName("head")[0].appendChild(r)}else{console.log("[document.write]",e);var c=Math.random().toString(36).slice(2),i=t.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,l+"="+c+' src="'+e+'"$1');document.write(i);var a=document.querySelector("script["+l+'="'+c+'"]');a&&(a.onload=n)}},w=function(t,e,n){var r=j.createElement("link");Object.keys(HTMLLinkElement.prototype).forEach(function(e){if("href"!==e&&t[e]&&"object"!=typeof t[e])try{r[e]=t[e]}catch(e){}}),r.href=e,r.onload=n,j.getElementsByTagName("head")[0].appendChild(r)},p={},M=function(e,t){var n,r=a(e,t);if(!r)return[];var o,c,i=(c=r,(o=e).substr(o.indexOf(c)+c.length,o.length));return p[i]=p[i]||((n={})[y]=0,n[v]=[],n[m]=[],n),[r,p[i]]};function k(s,e){var l=e[f],d=i(e[g]),p=e[h];return t.reduce(function(e,t){var n=c(HTMLScriptElement.prototype,t);return e[t]=n?{value:function(){return s[E][t].apply(s[E],arguments)}}:{set:function(o){return"onerror"===t?(s[b]=o,void(s[E].onerror=function(e){e.stopPropagation&&e.stopPropagation();var t=s[E].src,n=M(t,d),r=n[0],o=n[1];if(r&&o){var c=L(t,r,d[r]),i=p(c,t,o);if(null!==i){if("string"!=typeof i)throw new Error("a string should be returned in `onRetry` function");var a,u,f;o[y]<l?T(s[E],i):(a=s[b],u=s[E],f=e,"function"==typeof a&&a.call(u,f))}}})):"onload"===t?(s._$assetsRetryOnload=o,void(s[E].onload=function(e){var t=s[E].src,n=M(t,d),r=(n[0],n[1]);r&&(-1===r[v].indexOf(t)&&r[m].push(t),o&&!o._called&&(o._called=!0,o.call(s[E],e)))})):void(s[E][t]=o)},get:function(){return s[E][t]}},e},{})}var t=function(e){for(var t=Object.getPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__},n=Object.keys(e);t(e);)n=n.concat(Object.keys(t(e))),e=t(e);return n}(HTMLScriptElement.prototype),H=function(n){var r=j.createElement;j.createElement=function(e,t){return e===s?function(e,t){var n;e.setAttribute(O,"true");var r=((n={})[E]=e,n[b]=u,n),o=k(r,t);return Object.defineProperties(r,o),r}(r.call(j,s),n):r.call(j,e,t)},j.createElement.toString=function(){return"function createElement() { [native code] }"}},R=function(n,e){Object.keys(n).filter(function(e){return c(n,e)}).forEach(function(e){var t=n[e];n[e]=function(){var e=[].slice.call(arguments).map(function(e){return d.call(e,E)?e[E]:e});return t.apply(this,e)},/^\w+$/.test(e)&&(n[e].toString=new Function("return 'function "+e+"() { [native code] }'"))})};function S(d){var p=d.onRetry;j.addEventListener("error",function(e){if(e){var t,n=e.target||e.srcElement,r=d.domain,o=(t=n)instanceof HTMLScriptElement||t instanceof HTMLImageElement?t.src:t instanceof HTMLLinkElement?t.href:null;if(o){var c=M(o,r),i=c[0],a=c[1];if(a&&i&&(a[y]++,a[v].push(o),r[i]&&!(a[y]>d.maxRetryCount))){var u=r[i],f=L(o,i,u),s=p(f,o,a);if(null!==s){if("string"!=typeof s)throw new Error("a string should be returned in `onRetry` function");console.log("[document.onerror]",s);var l=function(){a[m].push(s)};n instanceof HTMLScriptElement&&!n.getAttribute(O)&&n.src?T(n,s,l):n instanceof HTMLLinkElement&&n.href?w(n,s,l):n instanceof HTMLImageElement&&n.src&&(n.src=s,n.onload=l)}}}}},!0)}return function(e){var t;void 0===e&&(e={});try{if(o(e,f,3),o(e,h,r),"object"!=typeof e[g])throw new Error("opts.domain cannot be non-object.");var n=((t={})[f]=e[f],t[h]=e[h],t[g]=i(e[g]),t);return H(n),"undefined"!=typeof Node&&R(Node.prototype),"undefined"!=typeof Element&&R(Element.prototype),S(n),p}catch(e){console.error("[assetsRetry] error captured")}}});
//# sourceMappingURL=assets-retry.umd.js.map
</script>
    <script>
      window.assetsRetryStatistics = window.assetsRetry({ domain: ['a.cdn', 'b.cdn'] })
    </script>
    <title></title>
  <link href="styles.css" rel="stylesheet"></head>
  <body>
  <script type="text/javascript" src="bundle.js"></script></body>
</html>
